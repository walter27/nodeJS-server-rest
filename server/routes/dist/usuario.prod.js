"use strict";var express=require("express"),app=express(),Usuario=require("../models/usuario"),bcrypt=require("bcrypt"),_=require("underscore");app.get("/usuario",function(r,s){var o=r.query.desde||0;o=Number(o);var e=r.query.limite||5;e=Number(e),Usuario.find({estado:!0},"nombre email role estado google img").skip(o).limit(e).exec(function(r,e){if(r)return s.status(400).json({ok:!1,error:error});Usuario.count({estado:!0},function(r,o){s.json({ok:!0,usuarios:e,cantidad:o})})})}),app.post("/usuario",function(r,e){var o=r.body;new Usuario({nombre:o.nombre,email:o.email,password:bcrypt.hashSync(o.password,10),role:o.role}).save(function(r,o){if(r)return e.status(400).json({ok:!1,error:r});e.json({ok:!0,usuario:o})})}),app.put("/usuario/:id",function(r,e){var o=r.params.id,s=_.pick(r.body,["nombre","email","img","role","estado"]);Usuario.findByIdAndUpdate(o,s,{new:!0,runValidators:!0},function(r,o){if(r)return e.status(400).json({ok:!1,err:r});e.json({ok:!0,usuario:o})})}),app.delete("/usuario/:id",function(r,e){var o=r.params.id;Usuario.findByIdAndUpdate(o,{estado:!1},{new:!0},function(r,o){return r?e.status(400).json({ok:!1,err:r}):o?void e.json({ok:!0,usuario:o}):e.status(400).json({ok:!1,err:{message:"Usuario no encontrado"}})})}),module.exports=app;