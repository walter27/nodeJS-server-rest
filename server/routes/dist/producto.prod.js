"use strict";var express=require("express"),app=express(),Producto=require("../models/producto"),_require=require("../middlewares/autenticacion"),verficaToken=_require.verficaToken,verificaRol=_require.verificaRol;app.get("/productos",verficaToken,function(o,r){var e=o.query.desde||0;e=Number(e),Producto.find({disponible:!0}).skip(e).limit(5).populate("usuario","nombre email").populate("categoria","nombre").exec(function(o,e){if(o)return r.status(500).json({ok:!1,err:o});r.json({ok:!0,productos:e})})}),app.get("/producto/:id",function(o,r){var e=o.params.id;Producto.findById(e).populate("usuario","nombre email").populate("categoria","nombre").exec(function(o,e){return o?r.status(500).json({ok:!1,err:o}):e?void r.json({ok:!0,productoBD:e}):r.status(400).json({ok:!1,err:{message:"El id no existe"}})})}),app.post("/producto",verficaToken,function(o,r){var e=o.body;new Producto({nombre:e.nombre,precioUni:e.precioUni,descripcion:e.descripcion,disponible:e.disponible,categoria:e.categoria,usuario:o.usuario._id}).save(function(o,e){return o?r.status(500).json({ok:!1,err:o}):e?void r.json({ok:!0,producto:e}):r.status(400).json({ok:!1,err:o})})}),app.put("/producto/:id",verficaToken,function(o,r){var e=o.params.id,i=o.body,n={nombre:i.nombre,precioUni:i.precioUni,descripcion:i.descripcion,disponible:i.disponible,categoria:i.categoria,usuario:o.usuario._id};Producto.findByIdAndUpdate(e,n,{new:!0,runValidators:!0},function(o,e){return o?r.status(500).json({ok:!1,err:o}):e?void r.json({ok:!0,Producto:e}):r.status(400).json({ok:!1,err:{message:"el id no existe"}})})}),app.delete("/producto/:id",[verficaToken,verificaRol],function(o,r){var e=o.params.id,i={disponible:!1,usuario:o.usuario._id};Producto.findByIdAndUpdate(e,i,{new:!0},function(o,e){return o?r.status(400).json({ok:!1,err:o}):e?void r.json({ok:!0,producto:e}):r.status(400).json({ok:!1,err:{message:"Producto no encontrado"}})})}),app.get("/producto/buscar/:termino",verficaToken,function(o,r){var e=o.params.termino,i=new RegExp(e,"i");Producto.find({nombre:i}).populate("categoria","nombre").exec(function(o,e){if(o)return r.status(500).json({ok:!1,err:o});r.json({ok:!0,productos:e})})}),module.exports=app;